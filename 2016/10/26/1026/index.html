<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><title>find | xargs grep を知る - 1ミリもわからん</title><meta property=og:title content="find | xargs grep を知る - 1ミリもわからん"><link href=https://raahii.github.io/favicon.ico rel=icon type=image/x-icon><meta property=description content="はじめに  今回は頻繁につかうのに理解していないスクリプトがあるのでそれについて簡単に書こうと思います。そのスクリプトがコレです。"><link rel=icon href=https://raahii.github.io/images/favicon.ico type=image/x-icon><link rel=stylesheet href=https://raahii.github.io/css/main.css media=all><link rel=stylesheet href="//fonts.googleapis.com/css?family=Merriweather:400|Lato:400,400italic,700"></head><body><div class=wrapper><header class=header><nav class=nav><a href=https://raahii.github.io/ class=nav-logo><img src=https://raahii.github.io/images/bird.svg width=45 height=45 alt=Logo><p class=nav-title>1ミリもわからん</p></a><ul class=nav-links><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/raahii target=_blank>GitHub</a></li><li><a href=https://twitter.com/raahiiy target=_blank>Twitter</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>find | xargs grep を知る</h1><span class=article-date>October 26, 2016</span>
<span class=article-duration>1 min read</span><div class=article-content><p><body><h1>はじめに</h1></p><p>今回は頻繁につかうのに理解していない<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8>スクリプト</a>があるのでそれについて簡単に書こうと思います。その<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8>スクリプト</a>がコレです。</p><pre class="code lang-sh" data-lang=sh data-unlink> find . -name "*.py" -print0 | xargs -0 grep -i "pync"
 </pre><p>どんなことをする<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8>スクリプト</a>かご存知ですか？</p><p>これはカレント<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リ以下にあるファイル<code>*.py</code>の中から<code>pync</code>という単語を含むものをリストアップする<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%EF%A5%F3%A5%E9%A5%A4%A5%CA%A1%BC>ワンライナー</a>です。すなわちこういうことです。</p><pre class="code lang-sh" data-lang=sh data-unlink> find . -name "&lt;検索対象のファイルネーム&gt;" -print0 | xargs -0 grep -i "&lt;探したい単語&gt;"
 </pre><p>前から何度か使っていたものの、たまにしか使わないしすぐ忘れるだろうということで、すぐに<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%B7%A5%A7%A5%EB%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8>シェルスクリプト</a>ファイルで保存し「<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%D6%A5%E9%A5%C3%A5%AF%A5%DC%A5%C3%A5%AF%A5%B9>ブラックボックス</a>化」していました。最近になって特に多用するようになってきたのでちゃんと理解しようと思います。</p><h1>解読</h1><p>まず、パイプの左側の<code>find</code>の部分について。</p><pre class="code lang-sh" data-lang=sh data-unlink> find . -name "&lt;検索対象のファイルネーム&gt;" -print0
 </pre><p>言わずもがな<code>find .</code>でカレント<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リ以下の全ての<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リ・ファイルを列挙します。よくファイルを探す時に使いますね。</p><p>そして <code>-name "*.&lt;拡張子&gt;"</code>とすることで検索対象のファイルを限定します。ファイルをたくさん持つ<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リを検索するのであれば時間を短縮できます。加えてこれを使わずに実行すると、サブ<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リもリストアップされてしまい、パイプ以降に渡されるとエラーを起こします。結果が見づらくなるのでそれを防止する効果もありますね。</p><p>最後に<code>-print0</code>ですがこれは全く使ったことのないオプションだったのでmanで見てみると、</p><pre class=code data-lang data-unlink> -print0
　This primary always evaluates to true. It prints the pathname of the current file to standard output, followed by an ASCII NUL character (character code 0). </pre><p>とあります。簡単に訳すと「この引数は常に真と評価されます。ファイルのパスをASCIIのnull文字（0）を付けて標準出力に出力します。」という感じでしょうか。</p><p><span itemscope itemtype=http://schema.org/Photograph><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/b/bonhito/20161026/20161026000730.png alt=f🆔bonhito:20161026000730p:plain title=f🆔bonhito:20161026000730p:plain class=hatena-fotolife itemprop=image></span></p><p>実際に↑のような<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リで<code>-print0</code>を付けた場合とそうでない場合を比べてみます。</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>実行結果</th></tr></thead><tbody><tr><td style=text-align:center>-print0なし</td><td style=text-align:center><span itemscope itemtype=http://schema.org/Photograph><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/b/bonhito/20161026/20161026000830.png alt=f🆔bonhito:20161026000830p:plain title=f🆔bonhito:20161026000830p:plain class=hatena-fotolife itemprop=image></span></td></tr><tr><td style=text-align:center>-print0あり</td><td style=text-align:center><span itemscope itemtype=http://schema.org/Photograph><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/b/bonhito/20161026/20161026000836.png alt=f🆔bonhito:20161026000836p:plain title=f🆔bonhito:20161026000836p:plain class=hatena-fotolife itemprop=image></span></td></tr></tbody></table><p><code>-print0</code>してもただつながってるようにしかみえませんが、hexdumpすると確認できます。</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>実行結果</th></tr></thead><tbody><tr><td style=text-align:center>-print0なし</td><td style=text-align:center><span itemscope itemtype=http://schema.org/Photograph><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/b/bonhito/20161026/20161026103848.png alt=f🆔bonhito:20161026103848p:plain:w500 title=f🆔bonhito:20161026103848p:plain:w500 class=hatena-fotolife style=width:500px itemprop=image></span></td></tr><tr><td style=text-align:center>-print0あり</td><td style=text-align:center><span itemscope itemtype=http://schema.org/Photograph><img src=https://cdn-ak.f.st-hatena.com/images/fotolife/b/bonhito/20161026/20161026103849.png alt=f🆔bonhito:20161026103849p:plain:w500 title=f🆔bonhito:20161026103849p:plain:w500 class=hatena-fotolife style=width:500px itemprop=image></span></td></tr></tbody></table><p>そして後半の<code>xargs</code>以降。</p><pre class="code lang-sh" data-lang=sh data-unlink> xargs -0 grep -i "&lt;探したい単語&gt;"
 </pre><p><code>xargs</code>はこれも言わずもがなリダイレクトされた標準出力を次のコマンドの引数として渡すコマンドです。今回は次の<code>grep</code>に渡します。ただ<code>-0</code>はなんだろうということでmanを見ると</p><pre class=code data-lang data-unlink> -0      Change xargs to expect NUL (``\0'') characters as separators, instead of spaces and newlines.  This is expected to be used in concert with the -print0 function in find(1). </pre><p>なるほど、<code>find</code>の<code>-print0</code>とペアなのだとわかります。これは高速化のためでしょうか。調べてみると全く違いました。実際使うとうまくいかないので気づくのですが、<code>xargs</code>は<b>スペースまたは改行で区切って順に<code>grep</code>の引数に渡してしまう</b>ので空白を含むファイルで<code>No such file or directory</code>のエラーがでてしまいます。</p><p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fkaworu.jpn.org%2Fkaworu%2F2008-12-08-1.php" title="UNIX findとxargsコマンドで-print0オプションを使う理由" class="embed-card embed-webcard" scrolling=no frameborder=0 style="display:block;width:100%;height:155px;max-width:500px;margin:10px 0"></iframe><cite class=hatena-citation><a href=http://kaworu.jpn.org/kaworu/2008-12-08-1.php>kaworu.jpn.org</a></cite></p><p>最後に<code>grep -i</code>ですが、同様にmanを見ると</p><pre class=code data-lang data-unlink> -i, --ignore-case
             Perform case insensitive matching.  By default, grep is case sensitive. </pre><p><code>case insentive matching</code>とは大文字小文字を無視するということですね。</p><h1>まとめ</h1><p>当たり前ですが特別トリッキーなことはしていないので理解できて良かったです。大筋の流れとして<code>find</code>で列挙したファイル内の文字列に対して<code>grep</code>を実行するのだなというのもより強くインプットできました。また、最後に<code>grep</code>を実行するので最初に述べたように<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リが渡されるのはまずいというわけですね。</p><p>ただそれでも毎回打つのはやはり面倒くさいので、結局</p><pre class="code lang-sh" data-lang=sh data-unlink> # find word
alias findword='find . -type f -print0 | xargs -0 grep -i $1'
 </pre><p>と.zshrcに追記。実際のケースでは比較的小さな作業用<a class=keyword href=http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8>ディレクト</a>リを検索することが多いので<code>-name</code>で限定はせずに<code>-type f</code>でファイルのみを全て出力させています。</p><p>めでたしめでたし👏🏼 。かなりざっくり書いたので間違いや表現に問題があれば気軽にコメントいただけると嬉しいです。</p><h1>英語のお勉強メモ</h1><table><thead><tr><th style=text-align:center>単語</th><th style=text-align:center>意味</th></tr></thead><tbody><tr><td style=text-align:center><code>evaluate to</code></td><td style=text-align:center><a href=http://d.hatena.ne.jp/ymoto/20080716/p1>"expression A evaluates to value B" なら、「式 A は値 B として評価される」という意味。</a></td></tr><tr><td style=text-align:center><code>followed by</code></td><td style=text-align:center><a href=http://www.ldoceonline.com/dictionary/follow>"HAPPEN AFTER"</a> : to happen or do something after something else</td></tr></tbody></table><p></body></p></div></article><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"raahii"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><h3>こちらの記事もどうぞ</h3><ul class="related-content article-content"><li><a href=/2016/09/21/0921/>imgcatコマンドで遊ぶ</a></li><li><a href=/2016/05/30/0530/>Wordで上下の余白が消えてしまった時</a></li><li><a href=/2017/07/01/0701/>LaTeXiTで数式が表示されない問題</a></li></ul></main><footer class=footer><ul class=footer-links><li><a href=https://gohugo.io/ class=footer-links-kudos>Made with <img src=https://raahii.github.io/images/hugo-logo.png width=22 height=22></a></li></ul></footer></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-86522604-4','auto');ga('send','pageview');}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css integrity=sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js integrity=sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false}]});});</script></body></html>