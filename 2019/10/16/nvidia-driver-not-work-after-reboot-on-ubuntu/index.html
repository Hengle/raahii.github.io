<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><title>nvidiaのドライバが再起動の度に無効になる問題 (Ubuntu16.04) - 1ミリもわからん</title><meta property=og:title content="nvidiaのドライバが再起動の度に無効になる問題 (Ubuntu16.04) - 1ミリもわからん"><link href=https://raahii.github.io/favicon.ico rel=icon type=image/x-icon><link rel=icon href=https://raahii.github.io/images/favicon.ico type=image/x-icon><link rel=stylesheet href=https://raahii.github.io/css/main.css media=all><link rel=stylesheet href="//fonts.googleapis.com/css?family=Merriweather:400|Lato:400,400italic,700"></head><body><div class=wrapper><header class=header><nav class=nav><a href=https://raahii.github.io/ class=nav-logo><img src=https://raahii.github.io/images/bird.svg width=45 height=45 alt=Logo><p class=nav-title>1ミリもわからん</p></a><ul class=nav-links><li><a href=/about/>About</a></li><li><a href=https://github.com/raahii target=_blank>GitHub</a></li><li><a href=https://twitter.com/raahiiy target=_blank>Twitter</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>nvidiaのドライバが再起動の度に無効になる問題 (Ubuntu16.04)</h1><span class=article-date>October 16, 2019</span>
<span class=article-duration>1 min read</span><div class=article-content><h2 id=症状>症状</h2><p>Cudaをインストール手順を一通り済ませているにも関わらず，Ubuntuを起動するたびに <code>nvidia-smi</code> コマンドが実行できない．下記のようなエラーが吐かれる．</p><blockquote><p>NVIDIA-SMI has failed because it couldn&rsquo;t communicate with the NVIDIA driver. Make sure that the latest NVIDIA driver is installed and running.</p></blockquote><h2 id=解決策>解決策</h2><p>原因は <code>.run</code> を使ってドライバのインストールをしていたからだった．下記のページが非常に参考になった．</p><ul><li><a href=https://devtalk.nvidia.com/default/topic/1047781/nvidia-driver-not-work-after-reboot-on-ubuntu/ target=_blank>Nvidia driver not work after reboot on Ubuntu - NVIDIA Developer Forums</a></li></ul><p>とはいえ，Ubuntuの場合はppaからドライバを直接インストールできるので，<code>apt</code>を使ったほうが良い．</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>❯ sudo add-apt-repository ppa:graphics-drivers/ppa
❯ sudo apt update</code></pre></div><p>検索すると色々出てくるのでインストールされているGPU及びCUDAに合ったバージョンを入れる．</p><ul><li><p><a href="https://www.nvidia.co.jp/Download/index.aspx?lang=jp" target=_blank>ドライバの検索</a></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>❯ sudo apt search <span style=color:#d14>&#34;nvidia-[0-9]+\$&#34;</span>
Sorting... Done
Full Text Search... Done
nvidia-304/xenial <span style=color:#099>304</span>.137-0ubuntu0~gpu16.04.1 amd64
NVIDIA legacy binary driver - version <span style=color:#099>304</span>.137

nvidia-331/xenial-updates,xenial <span style=color:#099>340</span>.107-0ubuntu0.16.04.2 amd64
Transitional package <span style=color:#000;font-weight:700>for</span> nvidia-331

nvidia-340/xenial-updates,xenial <span style=color:#099>340</span>.107-0ubuntu0.16.04.2 amd64
NVIDIA binary driver - version <span style=color:#099>340</span>.107

      ︙

❯ sudo apt install nvidia-430 <span style=color:#998;font-style:italic># 例</span></code></pre></div></li></ul><p>再起動して<code>nvidia-smi</code> が表示されればOK.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>❯ nvidia-smi                                                                                 Wed Oct <span style=color:#099>16</span> <span style=color:#099>22</span>:19:32 <span style=color:#099>2019</span>
+-----------------------------------------------------------------------------+
| NVIDIA-SMI <span style=color:#099>430</span>.26       Driver Version: <span style=color:#099>430</span>.26       CUDA Version: <span style=color:#099>10</span>.2     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|<span style=color:#000;font-weight:700>===============================</span>+<span style=color:#000;font-weight:700>======================</span>+<span style=color:#000;font-weight:700>======================</span>|
|   <span style=color:#099>0</span>  TITAN RTX           Off  | <span style=color:#099>00000000</span>:01:00.0 Off |                  N/A |
| <span style=color:#099>23</span>%   42C    P0     1W / 280W |      0MiB / 24219MiB |      <span style=color:#099>0</span>%      Default |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID   Type   Process name                             Usage      |
|<span style=color:#000;font-weight:700>=============================================================================</span>|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+</code></pre></div></div></article><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"raahii"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><h3>こちらの記事もどうぞ</h3><ul><li><a href=/2018/12/12/conditional-batch-normalization/>Conditional Batch Normalizationについて</a></li><li><a href=/2019/08/04/files-upload/>画像データをサーバーにPOSTする</a></li><li><a href=/2018/05/13/add-video-method-for-tensorboard-chainer/>tensorboard-chainerにビデオを記録するためのPRを出した</a></li><li><a href=/2017/10/09/voxel/>3Dオブジェクト（ボクセルデータ）を描画するツールを作った</a></li><li><a href=/2015/11/14/174743/>人工知能とは</a></li></ul></main><footer class=footer><ul class=footer-links><li><a href=https://gohugo.io/ class=footer-links-kudos>Made with <img src=https://raahii.github.io/images/hugo-logo.png width=22 height=22></a></li></ul></footer></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-86522604-4','auto');ga('send','pageview');}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css integrity=sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js integrity=sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false}]});});</script></body></html>